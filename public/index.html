<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Sushi Shop</title>
  <link rel="stylesheet" href="./css/index.css">
  <link rel="shortcut icon" href="./images/logo-sushi-shop.png">
  <style>
  bot.body {
  width: 500px;
  margin: 0 auto;
  margin-top: 20px;
}

bot.div {
  position: absolute;
}

bot.input {
  width: 400px;
}

bot.button {
  width: 50px;
}

bot.textarea {
  width: 100%;
}

  </style>
</head>

<body>
    <div class="bot">
      <textarea readOnly=t rue; id="response" cols="40" rows="20" style="resize: none;"></textarea>
      <br />
      <input id="input" type="text" placeholder="Type here..." autocomplete="off" />
      <button id="rec">Speak</button>
    </div>
  <!-- <div class="homepage">
    <iframe width="350" height="430" src="https://console.dialogflow.com/api-client/demo/embedded/85876a4c-de8b-4184-9345-5fdad962466a">
    </iframe>
    <div class="chatbot">
      <img src="./images/chatbot.png" alt="chatbot">
    </div>
  </div> -->
  <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
  <script scr="js/index.js"></script>
  <script>
      var accessToken ="3bcce1286e324b5e94541e923bfac943";
    var baseUrl = "https://api.dialogflow.com/v1/";
    $(document).ready(function() {
        $("#input").keypress(function(event) {
            if (event.which == 13) {
                event.preventDefault();
                send();
this.value = '';
            }
        });
        $("#rec").click(function(event) {
            switchRecognition();
        });
    });
    var recognition;
    function startRecognition() {
        recognition = new webkitSpeechRecognition();
        recognition.onstart = function(event) {
            updateRec();
        };
        recognition.onresult = function(event) {
            var text = "";
            for (var i = event.resultIndex; i < event.results.length; ++i) {
                text += event.results[i][0].transcript;
            }
            setInput(text);
            stopRecognition();
        };
        recognition.onend = function() {
            stopRecognition();
        };
        recognition.lang = "fr-FR";
        recognition.start();
    }
    function stopRecognition() {
        if (recognition) {
            recognition.stop();
            recognition = null;
        }
        updateRec();
    }
    function switchRecognition() {
        if (recognition) {
            stopRecognition();
        } else {
            startRecognition();
        }
    }
    function setInput(text) {
        $("#input").val(text);
        send();
    }
    function updateRec() {
        $("#rec").text(recognition ? "Stop" : "Parlez");
    }
function send() {
        var text = $("#input").val();
        conversation.push("Moi: " + text + '\r\n');
        $.ajax({
        type: "POST",
        url: baseUrl + "query?v=20150910",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        headers: {
        "Authorization": "Bearer " + accessToken
        },
        data: JSON.stringify({ query: text, lang: "fr", sessionId: "somerandomthing" }),
        success: function(data) {
        var respText = data.result.fulfillment.speech;
        //responsiveVoice.setDefaultVoice("French Female");
        console.log("Respuesta: " + respText);
        setResponse(respText);
        responsiveVoice.speak(respText);
        },
        error: function() {
        setResponse("Internal Server Error");
        }
        });
        //setResponse("Thinking...");
        }
        function setResponse(val) {
        conversation.push("AI: " + val + '\r\n');
        //$("#response").text(val);
        $("#response").text(conversation.join(""));
        }
    function setResponse(val) {
	    //Edit "AI: " to change name
        conversation.push("Google: " + val + '\r\n');
        $("#response").text(conversation.join(""));
    }
    var conversation = [];
  </script>

</body>

</html>